<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Animal oceanographers | Working with vector data</title>
  <meta name="description" content="Skeleton Tutorial Template" />
  <meta name="generator" content="bookdown 0.15 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Animal oceanographers | Working with vector data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Skeleton Tutorial Template" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Animal oceanographers | Working with vector data" />
  
  <meta name="twitter:description" content="Skeleton Tutorial Template" />
  

<meta name="author" content="D March" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hello-world.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.2/leaflet-providers-plugin.js"></script>
<script language="javascript"> 
    function toggle(id) {
        var ele = document.getElementById("toggleText" + id);
        var text = document.getElementById("displayText" + id);
        var buttonText = text.innerHTML.replace("Show ", "");
        buttonText = buttonText.replace("Hide ", "");
        if(ele.style.display == "block") {
            ele.style.display = "none";
            text.innerHTML = "Show " + buttonText;
        } else {
            ele.style.display = "block";
            text.innerHTML = "Hide " + buttonText;
        }
    } 
</script>

<script language="javascript">
    function openCode(evt, codeName, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent" + id);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks" + id);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(codeName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script language="javascript">
    function hide(id){
        document.getElementById(id).style.display = "none";
    }
</script>
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Working with vector data in R</a></li>
<li class="chapter" data-level="2" data-path="hello-world.html"><a href="hello-world.html"><i class="fa fa-check"></i><b>2</b> Hello, world!</a><ul>
<li class="chapter" data-level="2.1" data-path="hello-world.html"><a href="hello-world.html#importing-vector-data"><i class="fa fa-check"></i><b>2.1</b> Importing vector data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="hello-world.html"><a href="hello-world.html#spatial-data-formats"><i class="fa fa-check"></i><b>2.1.1</b> Spatial data formats</a></li>
<li class="chapter" data-level="2.1.2" data-path="hello-world.html"><a href="hello-world.html#import-shapefiles"><i class="fa fa-check"></i><b>2.1.2</b> Import shapefiles</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="hello-world.html"><a href="hello-world.html#coordinate-reference-systems-crs"><i class="fa fa-check"></i><b>2.2</b> Coordinate Reference Systems (CRS)</a></li>
<li class="chapter" data-level="2.3" data-path="hello-world.html"><a href="hello-world.html#geographic-subset"><i class="fa fa-check"></i><b>2.3</b> Geographic subset</a><ul>
<li class="chapter" data-level="2.3.1" data-path="hello-world.html"><a href="hello-world.html#geographic-subset-by-setting-a-bounding-box"><i class="fa fa-check"></i><b>2.3.1</b> Geographic subset by setting a bounding box</a></li>
<li class="chapter" data-level="2.3.2" data-path="hello-world.html"><a href="hello-world.html#geographic-subset-by-data-attributes"><i class="fa fa-check"></i><b>2.3.2</b> Geographic subset by data attributes</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="hello-world.html"><a href="hello-world.html#import-vector-layer-point-data"><i class="fa fa-check"></i><b>2.4</b> Import vector layer: point data</a></li>
<li class="chapter" data-level="2.5" data-path="hello-world.html"><a href="hello-world.html#spatial-overlap"><i class="fa fa-check"></i><b>2.5</b> Spatial overlap</a></li>
<li class="chapter" data-level="2.6" data-path="hello-world.html"><a href="hello-world.html#interactive-maps"><i class="fa fa-check"></i><b>2.6</b> Interactive maps</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html"><i class="fa fa-check"></i><b>3</b> Animal oceanographers</a><ul>
<li class="chapter" data-level="3.1" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#import-spatial-data-from-csv-files"><i class="fa fa-check"></i><b>3.1</b> Import spatial data from CSV files</a></li>
<li class="chapter" data-level="3.2" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#advanced-maps-with-ggplot2"><i class="fa fa-check"></i><b>3.2</b> Advanced maps with ggplot2</a></li>
<li class="chapter" data-level="3.3" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#movement-trajectory-data"><i class="fa fa-check"></i><b>3.3</b> Movement trajectory data</a></li>
<li class="chapter" data-level="3.4" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#convex-hull-polygon"><i class="fa fa-check"></i><b>3.4</b> Convex hull polygon</a></li>
<li class="chapter" data-level="3.5" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#export-new-objects"><i class="fa fa-check"></i><b>3.5</b> Export new objects</a></li>
<li class="chapter" data-level="3.6" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#animated-plots-for-movement-data"><i class="fa fa-check"></i><b>3.6</b> Animated plots for movement data</a><ul>
<li class="chapter" data-level="3.6.1" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#extra-bonus"><i class="fa fa-check"></i><b>3.6.1</b> Extra bonus</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="animal-oceanographers.html"><a href="animal-oceanographers.html#retrieve-animal-observations-using-r-client-for-apis"><i class="fa fa-check"></i><b>3.7</b> Retrieve animal observations using R client for APIs</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Working with vector data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="animal-oceanographers" class="section level1">
<h1><span class="header-section-number">3</span> Animal oceanographers</h1>
<div id="import-spatial-data-from-csv-files" class="section level2">
<h2><span class="header-section-number">3.1</span> Import spatial data from CSV files</h2>
<p>One of the core components of R are <code>data.frame</code> objects. You can turn tabular text files, spreadsheets and databases into <code>data.frame</code> objects. Having spatial coordinates in your <code>data.frame</code> will allow you to easily turn it into a spatial object.</p>
<p>In this example we will import a dataset of CTD (conductivity, temperature, depth) profiles from oceanographic sensors that were equipped on Souther Elephant Seals. This is a subset of the <a href="https://doi.org/10.17882/45461">MEOP-CTD in-situ data collection</a>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co"># Import data</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="co"># Subset of Mirounga leonina for 2012</span></a>
<a class="sourceLine" id="cb35-3" title="3">mirounga &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/meop/miorunga.csv&quot;</span>)</a>
<a class="sourceLine" id="cb35-4" title="4"><span class="kw">class</span>(mirounga)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">head</span>(mirounga)</a></code></pre></div>
<pre><code>##          species    ptt         tag                date      lon      lat
## 1 Southern ellie 113368 ct77-167-12 2012-03-17 10:40:00 110.5548 -66.4558
## 2 Southern ellie 113368 ct77-167-12 2012-03-17 14:20:00 110.3725 -66.3939
## 3 Southern ellie 113368 ct77-167-12 2012-03-17 23:20:00 110.4566 -66.3640
## 4 Southern ellie 113368 ct77-167-12 2012-03-18 01:10:00 110.4468 -66.3704
## 5 Southern ellie 113368 ct77-167-12 2012-03-18 10:30:00 110.4070 -66.3601
## 6 Southern ellie 113368 ct77-167-12 2012-03-18 14:40:00 110.4506 -66.3885
##    scientific_name
## 1 Mirounga leonina
## 2 Mirounga leonina
## 3 Mirounga leonina
## 4 Mirounga leonina
## 5 Mirounga leonina
## 6 Mirounga leonina</code></pre>
<p>Transform the <code>data.frame</code> into a <code>sp</code> class object</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="co"># load library</span></a>
<a class="sourceLine" id="cb39-2" title="2"><span class="kw">library</span>(rgdal)</a>
<a class="sourceLine" id="cb39-3" title="3"></a>
<a class="sourceLine" id="cb39-4" title="4"><span class="co"># Convert to spatial class</span></a>
<a class="sourceLine" id="cb39-5" title="5"><span class="kw">coordinates</span>(mirounga) &lt;-<span class="st"> </span><span class="er">~</span>lon<span class="op">+</span>lat</a>
<a class="sourceLine" id="cb39-6" title="6"></a>
<a class="sourceLine" id="cb39-7" title="7"><span class="co"># View spatial attributes</span></a>
<a class="sourceLine" id="cb39-8" title="8"><span class="kw">proj4string</span>(mirounga)  <span class="co"># displays the coordinate reference system (CRS)</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>We need to set the CRS of the spatial layer</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="co"># Use EPSG code</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="kw">proj4string</span>(mirounga) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>)</a>
<a class="sourceLine" id="cb41-3" title="3"></a>
<a class="sourceLine" id="cb41-4" title="4"><span class="co"># Alternative using proj4 string</span></a>
<a class="sourceLine" id="cb41-5" title="5"><span class="co"># proj4string(mirounga) &lt;- CRS(&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;)</span></a></code></pre></div>
<p>Using EPSG codes can be more convenient that using larger strings. You can find more about EPSG codes in <a href="https://spatialreference.org/">Spatial Reference</a></p>
<p>We now make a quick exploration by plotting the data</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="co"># Quick plot</span></a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">plot</span>(mirounga)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" /><!-- --></p>
<p>We may need to show some land map as reference</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="co"># Import countries</span></a>
<a class="sourceLine" id="cb43-2" title="2">countries &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="st">&quot;data/ne/ne_110m_admin_0_countries&quot;</span>, <span class="dt">layer =</span> <span class="st">&quot;ne_110m_admin_0_countries&quot;</span>)</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Git\spatial_data_analysis\data\ne\ne_110m_admin_0_countries&quot;, layer: &quot;ne_110m_admin_0_countries&quot;
## with 177 features
## It has 94 fields
## Integer64 fields read as strings:  POP_EST NE_ID</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">plot</span>(countries, <span class="dt">col =</span> <span class="st">&quot;grey80&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;grey80&quot;</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb45-2" title="2"><span class="kw">plot</span>(mirounga, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" /><!-- --></p>
</div>
<div id="advanced-maps-with-ggplot2" class="section level2">
<h2><span class="header-section-number">3.2</span> Advanced maps with ggplot2</h2>
<p>In this example we will use <code>ggplot2</code> to display the CTD data. Due to the high density, we will bin data into regular cells to summarize the observations. Finally, we will also explore how to change the CRS of the plot into a polar projection.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="co"># load library</span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb46-3" title="3"><span class="kw">library</span>(viridis)</a>
<a class="sourceLine" id="cb46-4" title="4"></a>
<a class="sourceLine" id="cb46-5" title="5"><span class="co"># Import a new world dataset</span></a>
<a class="sourceLine" id="cb46-6" title="6"><span class="co"># country layer have some issues using orthographic projection</span></a>
<a class="sourceLine" id="cb46-7" title="7">world &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;world&quot;</span>)  <span class="co"># turn data from the maps package in to a data frame suitable for plotting with ggplot2</span></a>
<a class="sourceLine" id="cb46-8" title="8"></a>
<a class="sourceLine" id="cb46-9" title="9"><span class="co"># Also turn back the CTD dataset into a data.frame</span></a>
<a class="sourceLine" id="cb46-10" title="10">mirounga_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(mirounga)</a>
<a class="sourceLine" id="cb46-11" title="11"></a>
<a class="sourceLine" id="cb46-12" title="12"><span class="co"># Plot</span></a>
<a class="sourceLine" id="cb46-13" title="13"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-14" title="14"><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">data =</span> mirounga_df, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">bins =</span> <span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-15" title="15"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> world, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">colour =</span> <span class="st">&quot;#c0c0c0&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-16" title="16"><span class="st">  </span><span class="kw">ylim</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">-30</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-17" title="17"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-18" title="18"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-19" title="19"><span class="st">  </span><span class="kw">coord_map</span>(<span class="st">&quot;ortho&quot;</span>, <span class="dt">orientation =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># orthographic projection from South Pole</span></a>
<a class="sourceLine" id="cb46-20" title="20"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="dt">trans =</span> <span class="st">&quot;log&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># log scale for bin count</span></a>
<a class="sourceLine" id="cb46-21" title="21"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="st">&quot;white&quot;</span>), <span class="co"># dark background</span></a>
<a class="sourceLine" id="cb46-22" title="22">        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb46-23" title="23">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(), <span class="co"># remove panel grid</span></a>
<a class="sourceLine" id="cb46-24" title="24">        <span class="dt">axis.text =</span> <span class="kw">element_blank</span>()) <span class="co"># remove x-axis value</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" /><!-- --></p>
</div>
<div id="movement-trajectory-data" class="section level2">
<h2><span class="header-section-number">3.3</span> Movement trajectory data</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="co"># Select one tag</span></a>
<a class="sourceLine" id="cb47-2" title="2">track &lt;-<span class="st"> </span>mirounga[mirounga<span class="op">$</span>tag <span class="op">==</span><span class="st"> &quot;ct77-167-12&quot;</span>,]</a>
<a class="sourceLine" id="cb47-3" title="3"><span class="kw">plot</span>(track, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb47-4" title="4"><span class="kw">plot</span>(countries, <span class="dt">col =</span> <span class="st">&quot;grey80&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;grey80&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-1.png" /><!-- --></p>
</div>
<div id="convex-hull-polygon" class="section level2">
<h2><span class="header-section-number">3.4</span> Convex hull polygon</h2>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="co"># Calculate convex hull polygon</span></a>
<a class="sourceLine" id="cb48-2" title="2"><span class="kw">library</span>(adehabitatHR)</a>
<a class="sourceLine" id="cb48-3" title="3">hull &lt;-<span class="st"> </span><span class="kw">mcp</span>(track, <span class="dt">percent =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb48-4" title="4"><span class="kw">plot</span>(hull, <span class="dt">col =</span> <span class="st">&quot;lightblue&quot;</span>)</a>
<a class="sourceLine" id="cb48-5" title="5"><span class="kw">plot</span>(track,<span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb48-6" title="6"><span class="kw">plot</span>(countries, <span class="dt">col =</span> <span class="st">&quot;grey80&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;grey80&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-25-1.png" /><!-- --></p>
</div>
<div id="export-new-objects" class="section level2">
<h2><span class="header-section-number">3.5</span> Export new objects</h2>
<p>Finally, we will export this new <code>sp</code> objects into a shapefile in order to be imported into a GIS software like QGIS</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="co"># Export to Shapefile</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="kw">writeOGR</span>(track, <span class="dt">dsn =</span> <span class="st">&quot;data/meop&quot;</span>, <span class="dt">layer =</span> <span class="st">&quot;track_points&quot;</span>, <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb49-3" title="3"><span class="kw">writeOGR</span>(hull, <span class="dt">dsn =</span> <span class="st">&quot;data/meop&quot;</span>, <span class="dt">layer =</span> <span class="st">&quot;track_hull&quot;</span>, <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb49-4" title="4"></a>
<a class="sourceLine" id="cb49-5" title="5"><span class="co"># Export to KML</span></a>
<a class="sourceLine" id="cb49-6" title="6"><span class="kw">writeOGR</span>(track, <span class="dt">dsn =</span> <span class="st">&quot;data/meop/track_points.kml&quot;</span>, <span class="dt">layer =</span> <span class="st">&quot;track&quot;</span>, <span class="dt">driver =</span> <span class="st">&quot;KML&quot;</span>, <span class="dt">overwrite_layer =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb49-7" title="7"><span class="kw">writeOGR</span>(hull, <span class="dt">dsn =</span> <span class="st">&quot;data/meop/track_hull.kml&quot;</span>, <span class="dt">layer =</span> <span class="st">&quot;hull&quot;</span>, <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="dt">overwrite_layer =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="animated-plots-for-movement-data" class="section level2">
<h2><span class="header-section-number">3.6</span> Animated plots for movement data</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="co"># Import libraries</span></a>
<a class="sourceLine" id="cb50-2" title="2"><span class="kw">library</span>(lubridate)  <span class="co"># parse times</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="kw">library</span>(move)  <span class="co"># move object class and tools for trajectories</span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="kw">library</span>(moveVis)  <span class="co"># animation plots</span></a></code></pre></div>
<p>First, we will convert the trajectory data into a move object</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="co"># Back transform SpatialPointsDataFrame into a data.frame</span></a>
<a class="sourceLine" id="cb51-2" title="2">track &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(track)</a>
<a class="sourceLine" id="cb51-3" title="3"></a>
<a class="sourceLine" id="cb51-4" title="4"><span class="co"># parse date time</span></a>
<a class="sourceLine" id="cb51-5" title="5">track<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">parse_date_time</span>(track<span class="op">$</span>date, <span class="st">&quot;Ymd HMS&quot;</span>)</a>
<a class="sourceLine" id="cb51-6" title="6"></a>
<a class="sourceLine" id="cb51-7" title="7"><span class="co"># convert to move object</span></a>
<a class="sourceLine" id="cb51-8" title="8">mdata &lt;-<span class="st"> </span><span class="kw">move</span>(<span class="dt">x=</span>track<span class="op">$</span>lon, <span class="dt">y=</span>track<span class="op">$</span>lat, <span class="dt">time=</span>track<span class="op">$</span>date, </a>
<a class="sourceLine" id="cb51-9" title="9">                  <span class="dt">data=</span>track, <span class="dt">proj=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84&quot;</span>), </a>
<a class="sourceLine" id="cb51-10" title="10">                  <span class="dt">animal=</span>track<span class="op">$</span>tag)</a></code></pre></div>
<p>Trajectories from animals or human can be recorded at irregular sampling intervals. To explore data using animations, we need to generated unique time frames. Therefore, we have to interpolate the trajectory at regular time intervals.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="co"># align move_data to a uniform time scale</span></a>
<a class="sourceLine" id="cb52-2" title="2"><span class="co"># For animation, unique frame times are needed </span></a>
<a class="sourceLine" id="cb52-3" title="3">m &lt;-<span class="st"> </span><span class="kw">align_move</span>(mdata, <span class="dt">res =</span> <span class="dv">1</span>, <span class="dt">digit =</span> <span class="dv">0</span>, <span class="dt">unit =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">spaceMethod =</span> <span class="st">&quot;greatcircle&quot;</span>)</a></code></pre></div>
<p>Next step is to create individuals frames for each time step</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="co"># create spatial frames with a OpenStreetMap watercolour map</span></a>
<a class="sourceLine" id="cb53-2" title="2">frames &lt;-<span class="st"> </span><span class="kw">frames_spatial</span>(m,  <span class="co"># move object</span></a>
<a class="sourceLine" id="cb53-3" title="3">                         <span class="dt">map_service =</span> <span class="st">&quot;carto&quot;</span>, <span class="dt">map_type =</span> <span class="st">&quot;voyager_no_labels&quot;</span>,  <span class="co"># base map</span></a>
<a class="sourceLine" id="cb53-4" title="4">                         <span class="dt">path_size =</span> <span class="dv">2</span>, <span class="dt">path_colours =</span> <span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># path</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="st">          </span><span class="kw">add_labels</span>(<span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># add some customizations</span></a>
<a class="sourceLine" id="cb53-6" title="6"><span class="st">          </span><span class="kw">add_northarrow</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;bottomright&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb53-7" title="7"><span class="st">          </span><span class="kw">add_scalebar</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;bottomleft&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="st">          </span><span class="kw">add_timestamps</span>(m, <span class="dt">type =</span> <span class="st">&quot;label&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb53-9" title="9"><span class="st">          </span><span class="kw">add_progress</span>(<span class="dt">size =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Processing movement data...
## Approximated animation duration: ˜ 9.12s at 25 fps for 228 frames
## Retrieving and compositing basemap imagery...
## Assigning raster maps to frames...
## Creating frames...</code></pre>
<p>We can preview one of the created frames</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1">frames[[<span class="dv">100</span>]] <span class="co"># preview one of the frames, e.g. the 100th frame</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-31-1.png" /><!-- --></p>
<p>Finally, we can generate an animation by combining all individual frames. This function takes a while…</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="co"># animate frames</span></a>
<a class="sourceLine" id="cb56-2" title="2"><span class="co"># animate_frames(frames, out_file = &quot;img/animation.gif&quot;, overwrite = TRUE, display = FALSE)</span></a></code></pre></div>
<div class="figure">
<img src="img/animation.gif" alt="Animation in lonlat" />
<p class="caption">Animation in lonlat</p>
</div>
<div id="extra-bonus" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Extra bonus</h3>
<p>We will combine our previous knowledge to transform data into a polar projection. And will use a custom base maps in raster format.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="co"># transform trajectory to the polar stereographic projection (EPSG:3031)</span></a>
<a class="sourceLine" id="cb57-2" title="2">mpol &lt;-<span class="st"> </span><span class="kw">spTransform</span>(m, <span class="kw">crs</span>(<span class="st">&quot;+init=epsg:3031&quot;</span>))</a>
<a class="sourceLine" id="cb57-3" title="3"></a>
<a class="sourceLine" id="cb57-4" title="4"><span class="co"># import base map</span></a>
<a class="sourceLine" id="cb57-5" title="5">bmap &lt;-<span class="st"> </span><span class="kw">brick</span>(<span class="st">&quot;data/ne/NE1_50M_SR_W/NE1_50M_SR_W.tif&quot;</span>)</a>
<a class="sourceLine" id="cb57-6" title="6"></a>
<a class="sourceLine" id="cb57-7" title="7"><span class="co"># plot base map raster</span></a>
<a class="sourceLine" id="cb57-8" title="8"><span class="kw">plot</span>(bmap)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-33-1.png" /><!-- --></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="co"># compose the 3 RGB bands of Tif file</span></a>
<a class="sourceLine" id="cb58-2" title="2"><span class="kw">plotRGB</span>(bmap)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-33-2.png" /><!-- --></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"><span class="co"># crop basedmap to extent of track (plus 2 degrees)</span></a>
<a class="sourceLine" id="cb59-2" title="2">bmap &lt;-<span class="st"> </span><span class="kw">crop</span>(bmap, <span class="kw">extent</span>(<span class="op">-</span><span class="dv">180</span>, <span class="dv">180</span>, <span class="dv">-90</span>, <span class="dv">-40</span>))</a>
<a class="sourceLine" id="cb59-3" title="3"></a>
<a class="sourceLine" id="cb59-4" title="4"><span class="co"># reproject raster to polar stereographic projection (EPSG:3031)</span></a>
<a class="sourceLine" id="cb59-5" title="5">bmap_pol &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(bmap, <span class="dt">crs =</span> <span class="kw">crs</span>(<span class="st">&quot;+init=epsg:3031&quot;</span>))</a>
<a class="sourceLine" id="cb59-6" title="6"></a>
<a class="sourceLine" id="cb59-7" title="7"><span class="co"># plot data</span></a>
<a class="sourceLine" id="cb59-8" title="8"><span class="kw">plotRGB</span>(bmap_pol, <span class="dt">addfun =</span> <span class="kw">lines</span>(mpol))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-33-3.png" /><!-- --></p>
<p>Prepare individual frames for animation. Note this time there are several differences in the code</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="co"># create spatial frames with a OpenStreetMap watercolour map</span></a>
<a class="sourceLine" id="cb60-2" title="2">frames &lt;-<span class="st"> </span><span class="kw">frames_spatial</span>(mpol,</a>
<a class="sourceLine" id="cb60-3" title="3">          <span class="dt">r_list =</span> bmap_pol, <span class="dt">r_times =</span> m<span class="op">$</span>time[<span class="dv">1</span>], <span class="dt">ext =</span> <span class="kw">extent</span>(bmap_pol),  <span class="co">#custom base map</span></a>
<a class="sourceLine" id="cb60-4" title="4">          <span class="dt">path_size =</span> <span class="dv">2</span>, <span class="dt">path_colours =</span> <span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-5" title="5"><span class="st">          </span><span class="kw">add_timestamps</span>(mpol, <span class="dt">type =</span> <span class="st">&quot;label&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-6" title="6"><span class="st">          </span><span class="kw">add_progress</span>(<span class="dt">size =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Processing movement data...
## Approximated animation duration: ˜ 9.12s at 25 fps for 228 frames
## Assigning raster maps to frames...
## Creating frames...</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1">frames[[<span class="dv">100</span>]] <span class="co"># preview one of the frames, e.g. the 100th frame</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-34-1.png" /><!-- --></p>
<p>This time, we will remove the axis labels</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="co"># remove axis</span></a>
<a class="sourceLine" id="cb63-2" title="2">frames &lt;-<span class="st"> </span><span class="kw">add_gg</span>(frames, <span class="dt">gg =</span> <span class="kw">expr</span>(<span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb63-3" title="3">                                         <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb63-4" title="4">                                         <span class="dt">axis.text =</span> <span class="kw">element_blank</span>())))</a>
<a class="sourceLine" id="cb63-5" title="5"></a>
<a class="sourceLine" id="cb63-6" title="6">frames[[<span class="dv">100</span>]] <span class="co"># preview one of the frames, e.g. the 100th frame</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" /><!-- --></p>
<p>Finally, we can generate an animation by combining all individual frames. This function takes a while…</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1"><span class="co"># animate frames</span></a>
<a class="sourceLine" id="cb64-2" title="2"><span class="co"># animate_frames(frames, out_file = &quot;img/animation_polar.gif&quot;, overwrite = TRUE, display = FALSE)</span></a></code></pre></div>
<div class="figure">
<img src="img/animation_polar.gif" alt="Animation in polar projection" />
<p class="caption">Animation in polar projection</p>
</div>
</div>
</div>
<div id="retrieve-animal-observations-using-r-client-for-apis" class="section level2">
<h2><span class="header-section-number">3.7</span> Retrieve animal observations using R client for APIs</h2>
<p>Several public online databases offer the posibility to extract their information using an application programming interface (API). An API is a set of routines, protocols, and tools for building software applications. There are some R packages that allow the connection to those APIs in order to retrieve information.</p>
<p>Here, we show the use of one client for the Ocean Biogeographic Information System that allow us to extract species occurrence records.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1"><span class="co"># load library</span></a>
<a class="sourceLine" id="cb65-2" title="2"><span class="kw">library</span>(robis)</a>
<a class="sourceLine" id="cb65-3" title="3"></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="co"># import data</span></a>
<a class="sourceLine" id="cb65-5" title="5"><span class="co"># records &lt;- occurrence(&quot;Physeter macrocephalus&quot;)  # Scientific name of the sperm whale. You can replace it with your favourite one!</span></a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hello-world.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
